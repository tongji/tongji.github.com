---
layout: post
title: "JavaScript closures"
description: "JavaScript 闭包"
category: 
tags: ["JavaScript", "闭包", "closure", "js-lang", "dev"]
---
{% include JB/setup %}

## 介绍

闭包是js中最强大的特性之一，但是如果没有理解就随意使用，是不可能很好地使用它们的。然而，创建闭包却相当容易，
甚至是在不知不觉中，但是伴随而来的是潜在的危害，特别是在一些相很常见的web浏览器环境中。
为了在使用闭包时扬长避短，就必须先搞懂它的工作原理。但是，要理解闭包，首先得搞懂作用域链是如何工作的，
以及对象的属性名称是如何解析的。

官方解释：

> **闭包**：闭包是指一个拥有自由变量（它"关闭"了该表达式）和绑定了这些变量的环境的表示式（通常是一个函数）

说得通俗点就是：闭包是指一个函数对象在建立时，绑定了当时作用域下有效的自由变量。所以支持闭包的语言，
必须支持First-Class function，创建函数对象并不就等于创建了闭包，创建函数对象并且同时绑定了自由变量，
那么该函数对象才能称之为闭包。

> **自由变量**：自由变量是相对于函数而言的，即不是区域变量也不是参数变量，它的作用范围基本是在函数定义范围内的，
所以它是有界变量。

对于闭包最简单的解释是ECMAScript中支持`内部函数`，即函数定义或函数表达式是可以被定义在其它`外部函数`中。并且该内部函数可以自由访问所有的本地变量、参数和那些在外部函数中的声明的内部函数。

当其中一个内部函数可以在它被嵌套的那个外部函数之外被访问时，一个闭包就会被创建。所以该内部函数有可能在外部函数返回后被执行。
在这个时候，它仍然可以自由访问本地变量、参数和那些在外部函数中的声明的内部函数。即使外部函数已经返回了，但是这些本地变量、参数或是函数声音仍然保持不变，并且依然可以与该内部函数相互作用。 

然而，想要正确地理解闭包就需要明白它背后的工作机制以及相当多的技术细节。

## 对象属性名称的解析

ECMAScript定义了两类对象，“本地对象”和“宿主对象”，以前属于本地对象的一个子类“内置对象”([ECMA 262 3rd Ed Section 4.3](http://bclary.com/2004/11/07/#a-4.3))。本地对象是独立于宿主环境的ECMAScript实现提供的对象，而宿主对象是由ECMAScript实现的宿主环境提供的对象，如document对象、DOM节点等等。

对象是属性的容器，其中每个属性都拥有名字和值。属性的名字可以是包括空字符串在内的任意字符串，一个对象的属性值可以是另外一个对象（函数同时也是对象）或者是String、Number、Boolean、Null或Undefined原生值。属性值为undefined似乎感觉很奇怪，但是确定有可能将undefined赋予某个对象的属性，但是这样做并不意味着删除了该发生，它仅仅表示该属性的值为undefined。

为了最大程度地了解内部的细节，下面是关于如何读取或者设置对象属性的一个简单例子。

## 标识符解析、执行上下文和作用域链

## 闭包

## 闭包能做什么？

## 闭包的副作用

## Internet Explorer的内存泄漏问题